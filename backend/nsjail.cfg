name: "python_sandbox"
mode: ONCE
hostname: "sandbox"
log_level: ERROR

mount {
  src: "/sandbox",
  dst: "/",
  is_bind: true,
  rw: true
}

# The working directory inside the chroot jail.
cwd: "/tmp"

# Environment variables for the sandboxed process.
envar: "HOME=/tmp"
envar: "LD_LIBRARY_PATH=/usr/local/lib:/lib/x86_64-linux-gnu:/usr/lib/x86_64-linux-gnu"
envar: "PYTHONPATH=/usr/local/lib/python3.11/site-packages"

# Disable all namespace and security features that conflict with gVisor
disable_rl: true
disable_no_new_privs: true
keep_caps: false
skip_setsid: true

# Use host namespaces (required for Cloud Run/gVisor)
clone_newnet: false
clone_newuser: false
clone_newns: false
clone_newpid: false
clone_newipc: false
clone_newuts: false
clone_newcgroup: false

# Resource limits for the sandboxed process.
time_limit: 10
max_cpus: 1
rlimit_as: 256
rlimit_fsize: 10
rlimit_nofile: 32

# The binary to execute. The path is inside the chroot.
exec_bin {
  path: "/usr/local/bin/python3"
  arg: "/tmp/script.py"
}

# Simplified seccomp policy for Cloud Run compatibility
seccomp_string: "DEFAULT ALLOW"