name: "python_sandbox"
mode: ONCE
hostname: "sandbox"
log_level: ERROR

# Use chroot for better Cloud Run compatibility
use_chroot: true
chroot: "/sandbox"

# Sandbox config
cwd: "/tmp"

# Simplified security settings for Cloud Run
clone_newnet: false
clone_newuser: false
clone_newns: false
clone_newpid: false
clone_newipc: false
clone_newuts: false
clone_newcgroup: false

# Resource limits
time_limit: 10
max_cpus: 1
rlimit_as: 256
rlimit_fsize: 10
rlimit_nofile: 32

# Environment variables
envar: "HOME=/tmp"
envar: "LD_LIBRARY_PATH=/usr/local/lib:/lib/x86_64-linux-gnu:/usr/lib/x86_64-linux-gnu"
envar: "PYTHONPATH=/usr/local/lib/python3.11/site-packages"

# Disable readline for security
disable_rl: true

# Execution binary and arguments
exec_bin {
  path: "/usr/local/bin/python3"
  arg: "python3"
  arg: "/tmp/script.py"
}

# Simplified seccomp for Cloud Run compatibility
seccomp_string: "KILL { chmod, fchmod, fchmodat, chown, fchown, lchown, setuid, setgid, setreuid, setregid, setresuid, setresgid, setfsuid, setfsgid, setgroups, mount, umount } DEFAULT ALLOW"